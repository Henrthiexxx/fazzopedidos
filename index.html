<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pedrad - Painel Admin</title>
    <meta name="theme-color" content="#8b5cf6">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="admin-reviews.css">
<link rel="stylesheet" href="admin-notifications.css">
<link rel="stylesheet" href="admin-coupons.css">
</head>
<body>


    <div class="toast" id="toast"></div>
    
    <!-- Auth -->
    <div id="authPage" class="auth-container">
        <div class="auth-box">
            <div class="auth-logo">
                <h1>üëë Pedrad Admin</h1>
                <p>Painel de Administra√ß√£o</p>
            </div>
            <div class="card">
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="admin@pedrad.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Entrar</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
        
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üëë Pedrad Admin</div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Vis√£o Geral</div>
                    <div class="nav-item active" onclick="showPage('dashboard')"><span>üìä</span> Dashboard</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Gest√£o</div>
                    <div class="nav-item" onclick="showPage('stores')"><span>üè™</span> Lojas <span class="nav-badge" id="storesBadge" style="display:none;">0</span></div>
                    <div class="nav-item" onclick="showPage('drivers')"><span>üõµ</span> Entregadores <span class="nav-badge" id="driversBadge" style="display:none;">0</span></div>
                    <div class="nav-item" onclick="showPage('orders')"><span>üì¶</span> Pedidos</div>
                    <div class="nav-item" onclick="showPage('users')"><span>üë•</span> Clientes</div>
                    <div class="nav-item" onclick="showPageAndInit('reviews', 'AdminReviews')">
    <span>‚≠ê</span>
    Avalia√ß√µes
</div>

<div class="nav-item" onclick="showPageAndInit('notifications', 'AdminNotifications')">
    <span>üì¢</span>
    Notifica√ß√µes
</div>

<div class="nav-item" onclick="showPageAndInit('coupons', 'AdminCoupons')">
    <span>üé´</span>
    Cupons
</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Financeiro</div>
                    <div class="nav-item" onclick="showPage('fees')"><span>üí≥</span> Taxas por Bairro</div>
                    <div class="nav-item" onclick="showPage('storeFees')"><span>üè∑Ô∏è</span> Taxas de Lojas</div>
                    <div class="nav-item" onclick="showPage('finance')"><span>üí∞</span> Financeiro</div>
                    <div class="nav-item" onclick="showPage('reports')"><span>üìà</span> Relat√≥rios</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Sistema</div>
                    <div class="nav-item" onclick="showPage('settings')"><span>‚öôÔ∏è</span> Configura√ß√µes</div>
                    <div class="nav-item" onclick="handleLogout()"><span>üö™</span> Sair</div>
                </div>
            </nav>
        </aside>
        
        <!-- Main -->
        <main class="main-content">
            <header class="topbar">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                    <h1 class="topbar-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="topbar-actions">
                    <span class="admin-badge">üëë Admin</span>
                </div>
            </header>
            
            <!-- Dashboard -->
            <div id="dashboardPage" class="page active">
                <div class="stats-grid">
                    <div class="stat-card purple"><div class="stat-icon">üè™</div><div class="stat-value" id="totalStores">0</div><div class="stat-label">Lojas ativas</div></div>
                    <div class="stat-card blue"><div class="stat-icon">üõµ</div><div class="stat-value" id="totalDrivers">0</div><div class="stat-label">Entregadores</div></div>
                    <div class="stat-card green"><div class="stat-icon">üì¶</div><div class="stat-value" id="totalOrders">0</div><div class="stat-label">Pedidos hoje</div></div>
                    <div class="stat-card yellow"><div class="stat-icon">üí∞</div><div class="stat-value" id="totalRevenue">R$ 0</div><div class="stat-label">Faturamento hoje</div></div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header"><div class="card-title">üì¶ Pedidos em Tempo Real</div></div>
                        <div id="liveOrders" class="live-orders"></div>
                    </div>
                    <div class="card">
                        <div class="card-header"><div class="card-title">üìä Resumo por Status</div></div>
                        <div id="statusSummary" class="status-summary"></div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header"><div class="card-title">üèÜ Top Lojas (Hoje)</div></div>
                    <div id="topStores"></div>
                </div>
            </div>
            
<!-- Stores -->
<div id="storesPage" class="page">
    <div class="page-header">
        <div class="filters">
            <div class="filter-chip active" onclick="filterStores('all')">Todas</div>
            <div class="filter-chip" onclick="filterStores('pending')">‚è≥ Pendentes</div>
            <div class="filter-chip" onclick="filterStores('active')">‚úÖ Ativas</div>
            <div class="filter-chip" onclick="filterStores('blocked')">üö´ Bloqueadas</div>
        </div>
        <input type="text" class="form-input search-input" placeholder="üîç Buscar loja..." id="storeSearch" oninput="renderStores()">
        <button class="btn btn-primary" onclick="openStoreModal()">+ Nova Loja</button>
    </div>
    <div id="storesList" class="data-list"></div>
</div>
            <!-- Drivers -->
            <div id="driversPage" class="page">
                <div class="page-header">
                    <div class="filters">
                        <div class="filter-chip active" onclick="filterDrivers('all')">Todos</div>
                        <div class="filter-chip" onclick="filterDrivers('online')">üü¢ Online</div>
                        <div class="filter-chip" onclick="filterDrivers('offline')">‚ö´ Offline</div>
                        <div class="filter-chip" onclick="filterDrivers('pending')">‚è≥ Pendentes</div>
                        <div class="filter-chip" onclick="filterDrivers('blocked')">üö´ Bloqueados</div>
                    </div>
                    <button class="btn btn-primary" onclick="openDriverModal()">+ Novo Entregador</button>
                </div>
                <div id="driversList" class="data-list"></div>
            </div>
            
            <!-- Orders -->
            <div id="ordersPage" class="page">
                <div class="page-header">
                    <div class="filters">
                        <div class="filter-chip active" onclick="filterOrders('all')">Todos</div>
                        <div class="filter-chip" onclick="filterOrders('pending')">üü° Pendentes</div>
                        <div class="filter-chip" onclick="filterOrders('preparing')">üîµ Preparando</div>
                        <div class="filter-chip" onclick="filterOrders('delivering')">üü¢ Entregando</div>
                        <div class="filter-chip" onclick="filterOrders('delivered')">‚úÖ Entregues</div>
                        <div class="filter-chip" onclick="filterOrders('cancelled')">‚ùå Cancelados</div>
                    </div>
                    <input type="date" class="form-input" id="orderDate" onchange="loadOrders()" style="width: auto;">
                </div>
                <div id="ordersList" class="data-list"></div>
            </div>
            
            <!-- Users -->
            <div id="usersPage" class="page">
                <div class="page-header">
                    <input type="text" class="form-input search-input" placeholder="üîç Buscar cliente..." id="userSearch" oninput="renderUsers()">
                    <button class="btn btn-primary" onclick="openUserModal()">+ Novo Cliente</button>
                </div>
                <div id="usersList" class="data-list"></div>
            </div>
            
            <!-- Reviews -->
            <div id="reviewsPage" class="page">
                <div class="page-header">
                    <div class="filters">
                        <div class="filter-chip active" onclick="filterReviews('all')">Todas</div>
                        <div class="filter-chip" onclick="filterReviews('store')">üè™ Lojas</div>
                        <div class="filter-chip" onclick="filterReviews('driver')">üõµ Entregadores</div>
                        <div class="filter-chip" onclick="filterReviews('product')">üì¶ Produtos</div>
                    </div>
                    <input type="text" class="form-input search-input" placeholder="üîç Buscar..." id="reviewSearch" oninput="renderReviews()">
                </div>
                <div id="reviewsList" class="data-list"></div>
            </div>
            
            <!-- Fees (Bairros) -->
            <div id="feesPage" class="page">
                <div class="page-header">
                    <h3 style="margin:0;">üí≥ Taxas de Entrega por Bairro</h3>
                    <button class="btn btn-primary" onclick="openFeeModal()">+ Novo Bairro</button>
                </div>
                <div class="card" style="margin-bottom:16px;">
                    <p style="color:var(--text-muted);margin:0;">Configure a taxa de entrega para cada bairro. Pedidos usar√£o a taxa do bairro de destino.</p>
                </div>
                <div id="feesList" class="data-list"></div>
            </div>
            
            <!-- Store Fees -->
            <div id="storeFeesPage" class="page">
                <div class="page-header">
                    <h3 style="margin:0;">üè∑Ô∏è Taxas da Plataforma por Loja</h3>
                </div>
                <div class="card" style="margin-bottom:16px;">
                    <p style="color:var(--text-muted);margin:0;">Defina a taxa cobrada de cada loja: valor fixo por pedido ou percentual sobre vendas.</p>
                </div>
                <div id="storeFeesList" class="data-list"></div>
            </div>
            <!-- M√ìDULO: ENVIAR NOTIFICA√á√ïES ADMIN -->

<div id="notificationsPage" class="page">
    <div class="page-header">
        <div class="topbar">
            <h2 class="topbar-title">Notifica√ß√µes</h2>
        </div>
    </div>

    <!-- Formul√°rio -->
    <div class="card" style="margin-bottom:20px;">
        <div class="card-title">üì¢ Nova Notifica√ß√£o</div>
        
        <div class="form-group">
            <label class="form-label">Destinat√°rios</label>
            <select class="form-input" id="notifTarget">
                <option value="all">Todos os clientes</option>
                <option value="select">Selecionar clientes</option>
            </select>
        </div>

        <div class="form-group" id="userSelectGroup" style="display:none;">
            <label class="form-label">Clientes (Ctrl+clique para m√∫ltiplos)</label>
            <select class="form-input" id="notifUsers" multiple size="5"></select>
        </div>
        
        <div class="form-group">
            <label class="form-label">T√≠tulo</label>
            <input type="text" class="form-input" id="notifTitle" placeholder="T√≠tulo da notifica√ß√£o">
        </div>
        
        <div class="form-group">
            <label class="form-label">Mensagem</label>
            <textarea class="form-input" id="notifMessage" rows="4" placeholder="Texto da mensagem"></textarea>
        </div>

        <div class="form-group">
            <div class="setting-item" style="padding:12px 0;">
                <div>
                    <div class="setting-label">Usar FCM (Push)</div>
                    <div class="setting-desc">Se desativado, usa localStorage (popup ao abrir app)</div>
                </div>
                <div class="toggle active" id="notifUseFCM" onclick="AdminNotifications.toggleFCM(this)"></div>
            </div>
        </div>

        <button class="btn btn-primary btn-block" onclick="AdminNotifications.send()">
            Enviar Notifica√ß√£o
        </button>
    </div>

    <!-- Hist√≥rico -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">üìã Hist√≥rico</div>
        </div>
        <div id="notifHistoryList"></div>
    </div>
</div>
            <!-- Finance -->
            <div id="financePage" class="page">
                <div class="stats-grid">
                    <div class="stat-card green"><div class="stat-icon">üíµ</div><div class="stat-value" id="financeToday">R$ 0</div><div class="stat-label">Hoje</div></div>
                    <div class="stat-card blue"><div class="stat-icon">üìÖ</div><div class="stat-value" id="financeWeek">R$ 0</div><div class="stat-label">Esta Semana</div></div>
                    <div class="stat-card purple"><div class="stat-icon">üìÜ</div><div class="stat-value" id="financeMonth">R$ 0</div><div class="stat-label">Este M√™s</div></div>
                    <div class="stat-card yellow"><div class="stat-icon">üè¶</div><div class="stat-value" id="platformFee">R$ 0</div><div class="stat-label">Taxa Plataforma</div></div>
                </div>
                
                <div class="card">
                    <div class="card-header"><div class="card-title">üí≥ Repasses Pendentes</div></div>
                    <div id="pendingPayouts"></div>
                </div>
                
                <div class="card">
                    <div class="card-header"><div class="card-title">üìä Faturamento por Loja</div></div>
                    <div id="storeRevenue"></div>
                </div>
            </div>
            
            <!-- Reports -->
            <div id="reportsPage" class="page">
                <div class="reports-grid">
                    <div class="report-card" onclick="generateReport('orders')">
                        <div class="report-icon">üì¶</div>
                        <div class="report-title">Relat√≥rio de Pedidos</div>
                        <div class="report-desc">Todos os pedidos do per√≠odo</div>
                    </div>
                    <div class="report-card" onclick="generateReport('stores')">
                        <div class="report-icon">üè™</div>
                        <div class="report-title">Relat√≥rio de Lojas</div>
                        <div class="report-desc">Performance das lojas</div>
                    </div>
                    <div class="report-card" onclick="generateReport('drivers')">
                        <div class="report-icon">üõµ</div>
                        <div class="report-title">Relat√≥rio de Entregadores</div>
                        <div class="report-desc">Entregas e ganhos</div>
                    </div>
                    <div class="report-card" onclick="generateReport('finance')">
                        <div class="report-icon">üí∞</div>
                        <div class="report-title">Relat√≥rio Financeiro</div>
                        <div class="report-desc">Faturamento completo</div>
                    </div>
                </div>
            </div>
            
            <!-- Settings -->
            <div id="settingsPage" class="page">
                <div class="settings-section">
                    <div class="settings-title">üí∞ Taxas Padr√£o da Plataforma</div>
                    <div class="form-group">
                        <label class="form-label">Taxa padr√£o por pedido (%)</label>
                        <input type="number" class="form-input" id="platformFeePercent" value="10" step="0.5" style="max-width: 200px;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Taxa m√≠nima por pedido (R$)</label>
                        <input type="number" class="form-input" id="platformFeeMin" value="2" step="0.5" style="max-width: 200px;">
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-title">üõµ Entregadores</div>
                    <div class="form-group">
                        <label class="form-label">Ganho base por entrega (R$)</label>
                        <input type="number" class="form-input" id="driverFee" value="5" step="0.5" style="max-width: 200px;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">B√¥nus por km extra (R$)</label>
                        <input type="number" class="form-input" id="driverKmBonus" value="1" step="0.5" style="max-width: 200px;">
                    </div>
                </div>
                <div id="reviewsPage" class="page">
    <!-- Header -->
    <div class="page-header">
        <div class="topbar">
            <h2 class="topbar-title">Avalia√ß√µes</h2>
        </div>
    </div>

    <!-- Filtros -->
    <div class="filter-bar" style="margin-bottom: 20px;">
        <div class="filter-chips">
            <div class="filter-chip active" data-filter="all">Todas</div>
            <div class="filter-chip" data-filter="pending">Pendentes</div>
            <div class="filter-chip" data-filter="purchased">A√ß√µes de Lojas</div>
        </div>
        <select class="filter-select" id="reviewStoreFilter">
            <option value="">Todas as lojas</option>
        </select>
    </div>

    <!-- Stats -->
    <div class="stats-grid" style="margin-bottom: 20px;">
        <div class="stat-card">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-value" id="totalReviews">0</div>
            <div class="stat-label">Total</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-value" id="avgRating">0.0</div>
            <div class="stat-label">M√©dia Geral</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üí≥</div>
            <div class="stat-value" id="purchasedActions">0</div>
            <div class="stat-label">A√ß√µes Compradas</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üè™</div>
            <div class="stat-value" id="storesWithCredits">0</div>
            <div class="stat-label">Lojas c/ Cr√©dito</div>
        </div>
    </div>

    <!-- Lista de Avalia√ß√µes -->
    <div class="data-list" id="reviewsList"></div>
</div>

<!-- MODAL: Detalhes da Avalia√ß√£o -->
<div class="modal" id="reviewDetailModal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h3 class="modal-title">Detalhes da Avalia√ß√£o</h3>
            <button class="modal-close" onclick="AdminReviews.closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="reviewDetailContent"></div>
    </div>
</div>

<!-- MODAL: Gerenciar Cr√©ditos da Loja -->
<div class="modal" id="storeCreditsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Cr√©ditos da Loja</h3>
            <button class="modal-close" onclick="AdminReviews.closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="storeCreditsContent"></div>
            <div class="form-group">
                <label class="form-label">Adicionar Cr√©ditos</label>
                <input type="number" class="form-input" id="creditsAmount" placeholder="Quantidade" min="1">
            </div>
            <button class="btn btn-primary btn-block" onclick="AdminReviews.addCredits()">Adicionar</button>
        </div>
    </div>
</div>
                <div class="settings-section">
                    <div class="settings-title">üîî Notifica√ß√µes</div>
                    <div class="setting-item">
                        <div class="setting-info"><div class="setting-label">Alertar novas lojas</div><div class="setting-desc">Receber alerta quando nova loja se cadastrar</div></div>
                        <div class="toggle active" id="alertNewStore" onclick="this.classList.toggle('active')"></div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><div class="setting-label">Alertar pedidos cancelados</div><div class="setting-desc">Monitorar cancelamentos</div></div>
                        <div class="toggle active" id="alertCancelled" onclick="this.classList.toggle('active')"></div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="saveSettings()">Salvar Configura√ß√µes</button>
            </div>
        </main>
    </div>
    
    <!-- Store Modal -->
    <div class="modal" id="storeModal">
        <div class="modal-content modal-lg">
            <div class="modal-header"><div class="modal-title">Detalhes da Loja</div><button class="modal-close" onclick="closeModal('storeModal')">√ó</button></div>
            <div class="modal-body" id="storeModalBody"></div>
            <div class="modal-footer" id="storeModalFooter"></div>
        </div>
    </div>
    
  <!-- Store Edit Modal -->
<div class="modal" id="storeEditModal">
    <div class="modal-content modal-lg">
        <div class="modal-header"><div class="modal-title">Editar Loja</div><button class="modal-close" onclick="closeModal('storeEditModal')">√ó</button></div>
        <div class="modal-body">
            <input type="hidden" id="storeEditId">
            <div class="form-row">
                <div class="form-group"><label class="form-label">Nome da Loja</label><input type="text" class="form-input" id="storeEditName"></div>
                <div class="form-group"><label class="form-label">Categoria</label><input type="text" class="form-input" id="storeEditCategory"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Email do Propriet√°rio</label><input type="email" class="form-input" id="storeEditEmail"></div>
                <div class="form-group"><label class="form-label">Senha de Acesso</label><input type="text" class="form-input" id="storeEditPassword" placeholder="Senha para login da loja"></div>
                <div class="form-group"><label class="form-label">Telefone</label><input type="tel" class="form-input" id="storeEditPhone"></div>
                
            </div>
            <div class="form-group"><label class="form-label">Endere√ßo</label><input type="text" class="form-input" id="storeEditAddress"></div>
            <div class="form-group">
                <label class="form-label">Imagem</label>
                <input type="file" accept="image/*" onchange="previewImage(this, 'storeEditImage', 'storeImgPreview')" style="margin-bottom:8px;">
                <input type="url" class="form-input" id="storeEditImage" placeholder="Ou cole a URL">
                <div id="storeImgPreview" class="img-preview"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Emoji</label><input type="text" class="form-input" id="storeEditEmoji" maxlength="2"></div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-input" id="storeEditStatus">
                        <option value="active">Ativa</option>
                        <option value="pending">Pendente</option>
                        <option value="blocked">Bloqueada</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Aberta?</label>
                    <select class="form-input" id="storeEditOpen">
                        <option value="true">Sim</option>
                        <option value="false">N√£o</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('storeEditModal')">Cancelar</button>
            <button class="btn btn-primary" onclick="saveStoreEdit()">Salvar</button>
        </div>
    </div>
</div>
    
<!-- Product Edit Modal -->
<div class="modal" id="productEditModal">
    <div class="modal-content">
        <div class="modal-header"><div class="modal-title" id="productEditTitle">Novo Produto</div><button class="modal-close" onclick="closeModal('productEditModal')">√ó</button></div>
        <div class="modal-body">
            <input type="hidden" id="productEditId">
            <div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-input" id="productEditName"></div>
            <div class="form-group"><label class="form-label">Descri√ß√£o</label><textarea class="form-input" id="productEditDesc" rows="2"></textarea></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Pre√ßo (R$)</label><input type="number" class="form-input" id="productEditPrice" step="0.01"></div>
                <div class="form-group"><label class="form-label">Categoria</label><input type="text" class="form-input" id="productEditCategory"></div>
            </div>
            <div class="form-group">
                <label class="form-label">Imagem</label>
                <input type="file" accept="image/*" onchange="previewImage(this, 'productEditImage', 'productImgPreview')" style="margin-bottom:8px;">
                <input type="url" class="form-input" id="productEditImage" placeholder="Ou cole a URL">
                <div id="productImgPreview" class="img-preview"></div>
            </div>
            <div class="form-group">
                <label class="form-label">Dispon√≠vel?</label>
                <select class="form-input" id="productEditAvailable">
                    <option value="true">Sim</option>
                    <option value="false">N√£o</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('productEditModal')">Cancelar</button>
            <button class="btn btn-primary" onclick="saveProduct()">Salvar</button>
        </div>
    </div>
</div>
    <!-- Product Edit Modal -->
    <div class="modal" id="productEditModal">
        <div class="modal-content">
            <div class="modal-header"><div class="modal-title" id="productEditTitle">Novo Produto</div><button class="modal-close" onclick="closeModal('productEditModal')">√ó</button></div>
            <div class="modal-body">
                <input type="hidden" id="productEditId">
                <div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-input" id="productEditName"></div>
                <div class="form-group"><label class="form-label">Descri√ß√£o</label><textarea class="form-input" id="productEditDesc" rows="2"></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Pre√ßo (R$)</label><input type="number" class="form-input" id="productEditPrice" step="0.01"></div>
                    <div class="form-group"><label class="form-label">Categoria</label><input type="text" class="form-input" id="productEditCategory"></div>
                </div>
                <div class="form-group"><label class="form-label">URL da Imagem</label><input type="url" class="form-input" id="productEditImage"></div>
                <div class="form-group">
                    <label class="form-label">Dispon√≠vel?</label>
                    <select class="form-input" id="productEditAvailable">
                        <option value="true">Sim</option>
                        <option value="false">N√£o</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('productEditModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveProduct()">Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- Driver Modal -->
    <div class="modal" id="driverModal">
        <div class="modal-content">
            <div class="modal-header"><div class="modal-title" id="driverModalTitle">Novo Entregador</div><button class="modal-close" onclick="closeModal('driverModal')">√ó</button></div>
            <div class="modal-body">
                <input type="hidden" id="driverId">
                <div class="form-group"><label class="form-label">Nome Completo</label><input type="text" class="form-input" id="driverName" placeholder="Nome do entregador"></div>
                <div class="form-group"><label class="form-label">E-mail (login)</label><input type="email" class="form-input" id="driverEmail" placeholder="email@exemplo.com"></div>
                <div class="form-group"><label class="form-label">Senha</label><input type="text" class="form-input" id="driverPassword" placeholder="Senha para acesso"></div>
                <div class="form-group"><label class="form-label">Telefone</label><input type="tel" class="form-input" id="driverPhone" placeholder="(00) 00000-0000"></div>
                <div class="form-group"><label class="form-label">CPF</label><input type="text" class="form-input" id="driverCPF" placeholder="000.000.000-00"></div>
                <div class="form-group"><label class="form-label">Ve√≠culo</label>
                    <select class="form-input" id="driverVehicle">
                        <option value="moto">üèçÔ∏è Moto</option>
                        <option value="bicicleta">üö≤ Bicicleta</option>
                        <option value="carro">üöó Carro</option>
                    </select>
                </div>
                <div class="form-group"><label class="form-label">Placa (se aplic√°vel)</label><input type="text" class="form-input" id="driverPlate" placeholder="ABC-1234"></div>
                <div class="form-group"><label class="form-label">PIX (para pagamento)</label><input type="text" class="form-input" id="driverPix" placeholder="Chave PIX"></div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-input" id="driverStatus">
                        <option value="active">Ativo</option>
                        <option value="pending">Pendente</option>
                        <option value="blocked">Bloqueado</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('driverModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveDriver()">Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- User Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header"><div class="modal-title" id="userModalTitle">Detalhes do Cliente</div><button class="modal-close" onclick="closeModal('userModal')">√ó</button></div>
            <div class="modal-body">
                <input type="hidden" id="userId">
                <div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-input" id="userName"></div>
                <div class="form-group"><label class="form-label">E-mail</label><input type="email" class="form-input" id="userEmail"></div>
                <div class="form-group"><label class="form-label">Telefone</label><input type="tel" class="form-input" id="userPhone"></div>
                <div class="form-group"><label class="form-label">CPF</label><input type="text" class="form-input" id="userCPF"></div>
                <hr style="border-color:var(--border);margin:16px 0;">
                <h4 style="margin:0 0 12px 0;">üìç Endere√ßo Principal</h4>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Rua</label><input type="text" class="form-input" id="userStreet"></div>
                    <div class="form-group" style="max-width:100px;"><label class="form-label">N¬∫</label><input type="text" class="form-input" id="userNumber"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Bairro</label><input type="text" class="form-input" id="userNeighborhood"></div>
                    <div class="form-group"><label class="form-label">Cidade</label><input type="text" class="form-input" id="userCity"></div>
                </div>
                <div class="form-group"><label class="form-label">Complemento</label><input type="text" class="form-input" id="userComplement"></div>
                <div class="form-group"><label class="form-label">Refer√™ncia</label><input type="text" class="form-input" id="userReference"></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Latitude</label><input type="text" class="form-input" id="userLat"></div>
                    <div class="form-group"><label class="form-label">Longitude</label><input type="text" class="form-input" id="userLng"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('userModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveUser()">Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- User Orders Modal -->
    <div class="modal" id="userOrdersModal">
        <div class="modal-content modal-lg">
            <div class="modal-header"><div class="modal-title">üì¶ Pedidos do Cliente</div><button class="modal-close" onclick="closeModal('userOrdersModal')">√ó</button></div>
            <div class="modal-body" id="userOrdersBody"></div>
        </div>
    </div>
    
    <!-- Order Modal -->
    <div class="modal" id="orderModal">
        <div class="modal-content modal-lg">
            <div class="modal-header"><div class="modal-title">Detalhes do Pedido</div><button class="modal-close" onclick="closeModal('orderModal')">√ó</button></div>
            <div class="modal-body" id="orderModalBody"></div>
            <div class="modal-footer" id="orderModalFooter"></div>
        </div>
    </div>
    
    <!-- Cancel Order Modal -->
    <div class="modal" id="cancelOrderModal">
        <div class="modal-content">
            <div class="modal-header"><div class="modal-title">‚ùå Cancelar Pedido</div><button class="modal-close" onclick="closeModal('cancelOrderModal')">√ó</button></div>
            <div class="modal-body">
                <input type="hidden" id="cancelOrderId">
                <p style="margin-bottom:16px;">Informe o motivo do cancelamento. O cliente ser√° notificado.</p>
                <div class="form-group">
                    <label class="form-label">Motivo</label>
                    <select class="form-input" id="cancelReason" onchange="toggleCustomReason()">
                        <option value="Loja fechada">Loja fechada</option>
                        <option value="Produto indispon√≠vel">Produto indispon√≠vel</option>
                        <option value="Endere√ßo fora da √°rea de entrega">Endere√ßo fora da √°rea</option>
                        <option value="Problemas com pagamento">Problemas com pagamento</option>
                        <option value="Pedido duplicado">Pedido duplicado</option>
                        <option value="custom">Outro motivo...</option>
                    </select>
                </div>
                <div class="form-group" id="customReasonGroup" style="display:none;">
                    <label class="form-label">Descreva o motivo</label>
                    <textarea class="form-input" id="cancelCustomReason" rows="3" placeholder="Descreva o motivo do cancelamento..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('cancelOrderModal')">Voltar</button>
                <button class="btn btn-danger" onclick="confirmCancelOrder()">Confirmar Cancelamento</button>
            </div>
        </div>
    </div>
    
    <!-- Review Modal -->
    <div class="modal" id="reviewModal">
        <div class="modal-content">
            <div class="modal-header"><div class="modal-title">‚≠ê Editar Avalia√ß√£o</div><button class="modal-close" onclick="closeModal('reviewModal')">√ó</button></div>
            <div class="modal-body">
                <input type="hidden" id="reviewId">
                <div class="form-group">
                    <label class="form-label">Atendimento (1-5)</label>
                    <input type="number" class="form-input" id="reviewService" min="1" max="5">
                </div>
                <div class="form-group">
                    <label class="form-label">Qualidade (1-5)</label>
                    <input type="number" class="form-input" id="reviewQuality" min="1" max="5">
                </div>
                <div class="form-group">
                    <label class="form-label">Tempo de Entrega (1-5)</label>
                    <input type="number" class="form-input" id="reviewTime" min="1" max="5">
                </div>
                <div class="form-group">
                    <label class="form-label">Custo-Benef√≠cio (1-5)</label>
                    <input type="number" class="form-input" id="reviewValue" min="1" max="5">
                </div>
                <div class="form-group">
                    <label class="form-label">Coment√°rio</label>
                    <textarea class="form-input" id="reviewComment" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-input" id="reviewStatus">
                        <option value="visible">Vis√≠vel</option>
                        <option value="hidden">Oculto</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('reviewModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveReview()">Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- Fee Modal -->
    <div class="modal" id="feeModal">
        <div class="modal-content">
            <div class="modal-header"><div class="modal-title" id="feeModalTitle">Nova Taxa de Bairro</div><button class="modal-close" onclick="closeModal('feeModal')">√ó</button></div>
            <div class="modal-body">
                <input type="hidden" id="feeId">
                <div class="form-group"><label class="form-label">Nome do Bairro</label><input type="text" class="form-input" id="feeName" placeholder="Ex: Centro"></div>
                <div class="form-group"><label class="form-label">Cidade</label><input type="text" class="form-input" id="feeCity" placeholder="Ex: S√£o Paulo"></div>
                <div class="form-group"><label class="form-label">Taxa de Entrega (R$)</label><input type="number" class="form-input" id="feeValue" step="0.50" placeholder="5.00"></div>
                <div class="form-group"><label class="form-label">Tempo Estimado (min)</label><input type="number" class="form-input" id="feeTime" placeholder="30"></div>
                <div class="form-group">
                    <label class="form-label">Ativo?</label>
                    <select class="form-input" id="feeActive">
                        <option value="true">Sim</option>
                        <option value="false">N√£o</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('feeModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveFee()">Salvar</button>
            </div>
        </div>
    </div>
    <!-- Products Modal -->
<div class="modal" id="productsModal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <div class="modal-title">üì¶ Produtos da Loja</div>
            <button class="modal-close" onclick="closeModal('productsModal')">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="productsStoreId">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                <span id="productsStoreName" style="font-weight:600;"></span>
                <button class="btn btn-primary btn-sm" onclick="openProductEditModal()">+ Novo Produto</button>
            </div>
            <div id="productsList"></div>
        </div>
    </div>
</div>
    <!-- Store Fee Modal -->
    <div class="modal" id="storeFeeModal">
        <div class="modal-content">
            <div class="modal-header"><div class="modal-title">üè∑Ô∏è Taxa da Loja</div><button class="modal-close" onclick="closeModal('storeFeeModal')">√ó</button></div>
            <div class="modal-body">
                <input type="hidden" id="storeFeeId">
                <p id="storeFeeName" style="font-weight:600;margin-bottom:16px;"></p>
                <div class="form-group">
                    <label class="form-label">Tipo de Taxa</label>
                    <select class="form-input" id="storeFeeType" onchange="toggleFeeInputs()">
                        <option value="percent">Percentual (%)</option>
                        <option value="fixed">Valor Fixo (R$)</option>
                    </select>
                </div>
                <div class="form-group" id="storeFeePercentGroup">
                    <label class="form-label">Percentual por Venda (%)</label>
                    <input type="number" class="form-input" id="storeFeePercent" step="0.5" placeholder="10">
                </div>
                <div class="form-group" id="storeFeeFixedGroup" style="display:none;">
                    <label class="form-label">Valor Fixo por Pedido (R$)</label>
                    <input type="number" class="form-input" id="storeFeeFixed" step="0.01" placeholder="0.25">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('storeFeeModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveStoreFee()">Salvar</button>
            </div>
        </div>
    </div>
<!-- M√ìDULO: CRIAR CUPONS -->

<div id="couponsPage" class="page">
    <div class="page-header">
        <div class="topbar">
            <h2 class="topbar-title">Cupons</h2>
            <button class="btn btn-primary btn-sm" onclick="AdminCoupons.openCreate()">
                + Criar Cupom
            </button>
        </div>
    </div>

    <!-- Stats -->
    <div class="stats-grid" style="margin-bottom:20px;">
        <div class="stat-card">
            <div class="stat-icon">üé´</div>
            <div class="stat-value" id="totalCoupons">0</div>
            <div class="stat-label">Total</div>
        </div>
        <div class="stat-card green">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-value" id="activeCoupons">0</div>
            <div class="stat-label">Ativos</div>
        </div>
        <div class="stat-card purple">
            <div class="stat-icon">üìä</div>
            <div class="stat-value" id="usedCoupons">0</div>
            <div class="stat-label">Usados</div>
        </div>
        <div class="stat-card yellow">
            <div class="stat-icon">‚è∞</div>
            <div class="stat-value" id="expiredCoupons">0</div>
            <div class="stat-label">Expirados</div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="filter-bar" style="margin-bottom:20px;">
        <div class="filter-chips">
            <div class="filter-chip active" data-filter="all">Todos</div>
            <div class="filter-chip" data-filter="active">Ativos</div>
            <div class="filter-chip" data-filter="expired">Expirados</div>
        </div>
    </div>

    <!-- Lista -->
    <div class="data-list" id="couponsList"></div>
</div>

<!-- MODAL: Criar/Editar Cupom -->
<div class="modal" id="couponModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="couponModalTitle">Criar Cupom</h3>
            <button class="modal-close" onclick="AdminCoupons.closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">C√≥digo do Cupom</label>
                <input type="text" class="form-input" id="couponCode" placeholder="PRIMEIRACOMPRA" style="text-transform:uppercase;">
            </div>

            <div class="form-group">
                <label class="form-label">Tipo de Desconto</label>
                <select class="form-input" id="couponType">
                    <option value="percent">Porcentagem (%)</option>
                    <option value="fixed">Valor Fixo (R$)</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Valor</label>
                    <input type="number" class="form-input" id="couponValue" placeholder="10" min="0" step="0.01">
                </div>

                <div class="form-group">
                    <label class="form-label">Pedido M√≠nimo (R$)</label>
                    <input type="number" class="form-input" id="couponMinValue" placeholder="0" min="0" step="0.01">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Limite de Usos</label>
                    <input type="number" class="form-input" id="couponLimit" placeholder="0 = ilimitado" min="0">
                </div>

                <div class="form-group">
                    <label class="form-label">Validade</label>
                    <input type="date" class="form-input" id="couponExpiry">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Loja Espec√≠fica (opcional)</label>
                <select class="form-input" id="couponStore">
                    <option value="">Todas as lojas</option>
                </select>
            </div>

            <div class="form-group">
                <div class="setting-item" style="padding:12px 0;">
                    <div>
                        <div class="setting-label">Cupom Ativo</div>
                        <div class="setting-desc">Desative para pausar sem deletar</div>
                    </div>
                    <div class="toggle active" id="couponActive"></div>
                </div>
            </div>

            <button class="btn btn-primary btn-block" onclick="AdminCoupons.save()" id="saveCouponBtn">
                Criar Cupom
            </button>
        </div>
    </div>
</div>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="index.js"></script>
    <script src="admin-reviews.js"></script>
<script src="admin-notifications.js"></script>
<script src="admin-coupons.js"></script>
</body>
</html>
